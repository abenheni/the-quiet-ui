<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Quiet Year</title>
    <link href="./dist/output.css" rel="stylesheet">
</head>
<body class="bg-gradient-to-br from-gray-900 to-gray-800 min-h-screen p-4">    <div class="max-w-4xl mx-auto">
        <h1 class="text-4xl font-bold text-gray-100 text-center mb-4">The Quiet Year</h1>
        
        <!-- Suit Selection -->
        <div class="bg-gray-700 rounded-lg shadow-lg p-6 mb-6 border border-gray-600">
            <h2 class="text-2xl font-semibold text-gray-100 mb-4">Select Suit</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 justify-center">
                <button id="heartsBtn" class="suit-btn bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-lg transition duration-300 active">
                    Hearts ‚ô•
                </button>
                <button id="diamondsBtn" class="suit-btn bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-lg transition duration-300">
                    Diamonds ‚ô¶
                </button>                <button id="spadesBtn" class="suit-btn bg-gray-900 hover:bg-gray-800 text-white font-bold py-3 px-4 rounded-lg transition duration-300">
                    Spades ‚ô†
                </button>
                <button id="clubsBtn" class="suit-btn bg-gray-900 hover:bg-gray-800 text-white font-bold py-3 px-4 rounded-lg transition duration-300">
                    Clubs ‚ô£
                </button>
            </div>
        </div>
        
        <!-- Season Theme Banner -->
        <div id="seasonBanner" class="text-center mb-6 py-4 px-6 rounded-lg bg-gradient-to-r from-gray-800 to-gray-700 border border-gray-600">
            <div class="flex items-center justify-center">
                <div id="seasonIcons" class="text-3xl mr-4">‚ô•</div>
                <div>
                    <div id="seasonName" class="text-xl font-medium text-gray-100">Spring</div>
                    <div id="seasonDescription" class="text-sm text-gray-300">A time of growth and discovery</div>
                </div>
            </div>
        </div><!-- Draw Card Section -->
        <div class="bg-gray-700 rounded-lg shadow-lg p-6 mb-6 border border-gray-600">
            <div class="text-center">
                <button id="drawBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-lg text-xl transition duration-300 mb-4">
                    Draw Card
                </button>                <div class="text-sm text-gray-300">
                    Cards remaining: <span id="cardCount">13</span>
                </div>
            </div>
        </div>        <!-- Card Display -->
        <div id="cardDisplay" class="bg-gray-700 rounded-lg shadow-lg p-8 text-center hidden border border-gray-600">
            <div class="text-6xl mb-4" id="cardSymbol"></div>
            <div class="text-3xl font-bold mb-2 text-gray-100" id="cardValue"></div>
            <div class="text-xl text-gray-400 mb-6" id="cardSuit"></div>            <!-- Card Content -->
            <div class="mt-6 border-t border-gray-700 pt-6">
                <div class="space-y-4">
                    <div class="p-4 bg-gray-800 rounded-lg border border-gray-600">
                        <div class="text-md font-medium text-gray-300 mb-2">Option 1</div>
                        <div id="cardPrimary" class="text-lg text-gray-100"></div>
                    </div>
                    <div class="p-4 bg-gray-800 rounded-lg border border-gray-600">
                        <div class="text-md font-medium text-gray-300 mb-2">Option 2</div>
                        <div id="cardSecondary" class="text-lg text-gray-100"></div>
                    </div>
                </div>
            </div>
        </div><!-- Card History -->
        <div class="bg-gray-700 rounded-lg shadow-lg p-6 border border-gray-600">
            <h3 class="text-xl font-semibold text-gray-100 mb-4">Drawn Cards</h3>
            <div id="cardHistory" class="grid grid-cols-8 gap-2 text-center"></div>
        </div></div>    <!-- Inline JavaScript - No modules to avoid CORS errors -->
    
    <!-- Card Overlay (Initially hidden) -->
    <div id="cardOverlay" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-800 rounded-lg shadow-xl p-8 max-w-lg w-full mx-4 relative border border-gray-600">            <button id="closeOverlay" class="absolute top-4 right-4 text-gray-400 hover:text-gray-100" title="Close card details" aria-label="Close card details">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <div class="text-center mb-4">
                <div class="text-6xl mb-4" id="overlaySymbol"></div>
                <div class="text-3xl font-bold mb-2 text-gray-100" id="overlayValue"></div>
                <div class="text-xl text-gray-400 mb-6" id="overlaySuit"></div>
            </div>
            <div class="mt-6 border-t border-gray-700 pt-6">
                <div class="space-y-4">
                    <div class="p-4 bg-gray-700 rounded-lg border border-gray-600">
                        <div class="text-md font-medium text-gray-300 mb-2">Option 1</div>
                        <div id="overlayPrimary" class="text-lg text-gray-100"></div>
                    </div>
                    <div class="p-4 bg-gray-700 rounded-lg border border-gray-600">
                        <div class="text-md font-medium text-gray-300 mb-2">Option 2</div>
                        <div id="overlaySecondary" class="text-lg text-gray-100"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ============== CONSTANTS ==============
        const GAME_CONSTANTS = {
            SUITS: ['Hearts', 'Diamonds', 'Spades', 'Clubs'],
            VALUES: ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'],
            SYMBOLS: {
                'Hearts': '‚ô•',
                'Diamonds': '‚ô¶',
                'Spades': '‚ô†',
                'Clubs': '‚ô£'
            },
            COLORS: {
                'Hearts': 'red',
                'Diamonds': 'red',
                'Spades': 'black',
                'Clubs': 'black'
            },
            SEASONS: {
                'Hearts': {
                    name: 'Spring',
                    description: 'A time of growth and discovery',
                    icons: 'üå± üå∑ üå∏',
                    gradientFrom: 'from-green-900',
                    gradientTo: 'to-green-700',
                    borderColor: 'border-green-600',
                    textColor: 'text-green-200'
                },
                'Diamonds': {
                    name: 'Summer',
                    description: 'A time of production and abundance',
                    icons: '‚òÄÔ∏è üåø üåª',
                    gradientFrom: 'from-yellow-800',
                    gradientTo: 'to-yellow-600',
                    borderColor: 'border-yellow-500',
                    textColor: 'text-yellow-200'
                },
                'Spades': {
                    name: 'Winter',
                    description: 'A time of harsh survival',
                    icons: '‚ùÑÔ∏è ‚òÉÔ∏è ‚õÑ',
                    gradientFrom: 'from-blue-900',
                    gradientTo: 'to-blue-800',
                    borderColor: 'border-blue-700',
                    textColor: 'text-blue-100'
                },
                'Clubs': {
                    name: 'Autumn',
                    description: 'A time of harvest and preparation',
                    icons: 'üçÇ üçÅ üå∞',
                    gradientFrom: 'from-orange-900',
                    gradientTo: 'to-orange-800',
                    borderColor: 'border-orange-700',
                    textColor: 'text-orange-100'
                }
            },
            DEFAULT_SUIT: 'Hearts',
            CARDS_PER_SUIT: 13,
            
            // Card content for The Quiet Year
            CARD_CONTENT: {
                'Hearts': {
                    'A': {
                        primary: 'What group has the highest status in the community? What must people do to gain inclusion in this group?',
                        secondary: 'Are there distinct family units in the community? If so, what family structures are common?'
                    },
                    '2': {
                        primary: 'There\'s a large body of water on the map. Where is it? What does it look like?',
                        secondary: 'There\'s a giant man-made structure on the map. Where is it? Why is it abandoned?'
                    },
                    '3': {
                        primary: 'Someone new arrives. Who?',
                        secondary: 'Two of the community\'s younger members get into a fight. What provoked them?'
                    },
                    '4': {
                        primary: 'What important and basic tools does the community lack?',
                        secondary: 'Where are you storing your food? Why is this a risky place to store things?'
                    },
                    '5': {
                        primary: 'There is a disquieting legend about this place. What is it?',
                        secondary: 'Alarming weather patterns destroy something. How and what?'
                    },
                    '6': {
                        primary: 'Are there children in the community? If there are, what is their role in the community?',
                        secondary: 'How old are the eldest members of the community? What unique needs do they have?'
                    },
                    '7': {
                        primary: 'Where does everyone sleep? Who is unhappy with this arrangement, and why?',
                        secondary: 'What natural predators roam this area? Are you safe?'
                    },
                    '8': {
                        primary: 'An old piece of machinery is discovered, broken but perhaps repairable. What is it? What would it be useful for?',
                        secondary: 'An old piece of machinery is discovered, cursed and dangerous. How does the community destroy it?'
                    },
                    '9': {
                        primary: 'A charismatic young girl convinces many to help her with an elaborate scheme. What is it? Who joins her endeavors?',
                        secondary: 'A charismatic young girl tries to tempt many into sinful or dangerous activity. Why does she do this? How does the community respond?'
                    },
                    '10': {
                        primary: 'There\'s another community somewhere on the map. Where are they? What sets them apart from you?',
                        secondary: 'What belief or practice helps to unify your community?'
                    },
                    'J': {
                        primary: 'You see a good omen. What is it?',
                        secondary: 'You see a bad omen. What is it?'
                    },
                    'Q': {
                        primary: 'What\'s the most beautiful thing in this area?',
                        secondary: 'What\'s the most hideous thing in this area?'
                    },                    'K': {
                        primary: 'A young boy starts digging in the ground, and discovers something unexpected. What is it?',
                        secondary: 'An old man confesses to past crimes and atrocities. What has he done?'
                    }
                },                'Diamonds': {
                    'A': {
                        primary: 'A contingent within the community demand to be heard. Who are they? What are they asking for?',
                        secondary: 'A contingent within the community have acted on their frustrations. What have they damaged, and why did they damage it? Is it permanent?'
                    },
                    '2': {
                        primary: 'Someone new arrives. Who? Why are they in distress?',
                        secondary: 'Someone leaves the community. Who? What are they looking for?'
                    },
                    '3': {
                        primary: 'Summer is a time for production and tending to the earth. Start a project related to food production.',
                        secondary: 'Summer is a time for conquest and the gathering of might. Start a project related to military readiness and conquest.'
                    },
                    '4': {
                        primary: 'The eldest among you dies. What caused the death?',
                        secondary: 'The eldest among you is very sick. Caring for them and searching for a cure requires the help of the entire community. Do not reduce project dice this week.'
                    },
                    '5': {
                        primary: 'A project finishes early. What led to its early completion?',
                        secondary: 'The weather is nice and people can feel the potential all around them. Start a new project.'
                    },
                    '6': {
                        primary: 'Outsiders arrive in the area. Why are they a threat? How are they vulnerable?',
                        secondary: 'Outsiders arrive in the area. How many? How are they greeted?'
                    },
                    '7': {
                        primary: 'Introduce a mystery at the edge of the map.',
                        secondary: 'An unattended situation becomes problematic and scary. What is it? How does it go awry?'
                    },
                    '8': {
                        primary: 'Someone tries to take control of the community by force. Do they succeed? Why do they do this?',
                        secondary: 'A headstrong community member decides to put one of their ideas in motion. Start a foolish project.'
                    },
                    '9': {
                        primary: 'A project fails. Which one? Why?',
                        secondary: 'Something goes foul and supplies are ruined. Add a new Scarcity.'
                    },
                    '10': {
                        primary: 'You discover a cache of supplies or resources. Add a new Abundance.',
                        secondary: 'A Scarcity has gone unaddressed for too long! Start a project that will alleviate that Scarcity.'
                    },
                    'J': {
                        primary: 'Predators and bad omens are afoot. You are careless, and someone goes missing under ominous circumstances. Who?',
                        secondary: 'Predators and bad omens are afoot. What measures do you take to keep everyone safe and under surveillance? Do not reduce project dice this week.'
                    },
                    'Q': {
                        primary: 'A project finishes early. Which one? Why? If there are no projects underway, boredom leads to a quarrel.',
                        secondary: 'A fight breaks out between two people. What is it about?'
                    },
                    'K': {
                        primary: 'Summer is fleeting. Discard the top two cards off the top of the deck and take two actions this week.',
                        secondary: 'Summer is fleeting. Discard the top two cards off the top of the deck and take two actions this week.'
                    }
                },                'Spades': {
                    'A': {
                        primary: 'Now is the time to conserve energy and resources. A project fails, but gain an Abundance.',
                        secondary: 'Now is the time for hurried labour and final efforts. A project finishes early, but gain a Scarcity.'
                    },
                    '2': {
                        primary: 'A headstrong community member takes charge of the community\'s work efforts. A project fails, and then a different project finishes early.',
                        secondary: 'A headstrong community member tries to take control of the community. How are they prevented from doing this? Due to the conflict, project dice are not reduced this week.'
                    },
                    '3': {
                        primary: 'Someone comes up with an ingenious solution to a big problem, and as a result a project finishes early. What was their idea?',
                        secondary: 'Someone comes up with a plan to ensure safety and comfort during the coldest months. Start a project related to this.'
                    },
                    '4': {
                        primary: 'An infected outsider arrives, seeking amnesty. They have some much-needed resources with them. Choose one: Welcome them into the community. Remove a Scarcity, but also introduce an infection into the community.',
                        secondary: 'Bar them from entry. What Scarcity could they have addressed? How does its need become more dire this week?'
                    },
                    '5': {
                        primary: 'Winter elements destroy a food source. If this was your only food source, add a Scarcity.',
                        secondary: 'Winter elements leave everyone cold, tired, and miserable. Project dice are not reduced this week.'
                    },
                    '6': {
                        primary: 'The time has come to consolidate your efforts and your borders. Projects located outside the settlement fail, and all remaining projects are reduced by 2 this week.',
                        secondary: 'Someone finds a curious opportunity on the edge of the map. Start a project related to this discovery.'
                    },
                    '7': {
                        primary: 'What is winter like in this area? How do community members react to the weather?',
                        secondary: 'What is winter like in this area? How do community members react to the weather?'
                    },
                    '8': {
                        primary: 'Winter is harsh, and desperation gives rise to fear mongering. Choose one: Spend the week calming the masses and dispelling their violent sentiments. The week ends immediately.',
                        secondary: 'Declare war on someone or something. This counts as starting a project.'
                    },
                    '9': {
                        primary: 'Someone goes missing. They\'re alone in the winter elements. Choose one: The community organizes constant search parties and eventually the person is found. Project dice are not reduced this week.',
                        secondary: 'No one ever hears from that person again.'
                    },
                    '10': {
                        primary: 'In preparation for the coming year, the community begins a huge undertaking. Start a project that will take at least 5 weeks to complete.',
                        secondary: 'In preparation for the coming year, the community begins a huge undertaking. Start a project that will take at least 5 weeks to complete.'
                    },
                    'J': {
                        primary: 'All the animals and young children are crying and won\'t stop. Hold a discussion about this, in addition to your regular action for this week.',
                        secondary: 'A great atrocity is revealed. What is it? Who uncovers it?'
                    },
                    'Q': {
                        primary: 'You see a good omen. What is it?',
                        secondary: 'You see a good omen. What is it?'
                    },
                    'K': {
                        primary: 'The Frost Shepherds arrive. The game is over.',
                        secondary: 'The Frost Shepherds arrive. The game is over.'
                    }
                },'Clubs': {
                    'A': {
                        primary: 'The community becomes obsessed with a single project. Which one? Why? Choose one: They decide to take more time to ensure that it is perfect. Add 3 weeks to the project die.',
                        secondary: 'They drop everything else to work on it. All other projects fail. If there are no projects underway, add a Scarcity born of idleness.'
                    },
                    '2': {
                        primary: 'Someone returns to the community. Who? Where were they?',
                        secondary: 'You find a body. Do people recognize who it is? What happened?'
                    },
                    '3': {
                        primary: 'Someone leaves the community after issuing a dire warning. Who? What is the warning?',
                        secondary: 'Someone issues a dire warning, and the community leaps into action to avoid disaster. What is the warning? Start a contentious project that relates to it.'
                    },
                    '4': {
                        primary: 'The strongest among you dies. What caused the death?',
                        secondary: 'The weakest among you dies. Who\'s to blame for their death?'
                    },
                    '5': {
                        primary: 'The Parish arrives. Who are they? Why have they chosen your community, and for what?',
                        secondary: 'A small gang of marauders is making its way through local terrain. How many are there? What weapons do they carry?'
                    },
                    '6': {
                        primary: 'Introduce a dark mystery among the members of the community.',
                        secondary: 'Conflict flares up among community members, and as a result, a project fails.'
                    },
                    '7': {
                        primary: 'A project just isn\'t working out as expected. Radically change the nature of this project (don\'t modify the project die). When it resolves, you\'ll be responsible for telling the community how it went.',
                        secondary: 'Something goes foul and supplies are ruined. Add a new Scarcity.'
                    },
                    '8': {
                        primary: 'Someone sabotages a project, and the project fails as a result. Who did this? Why?',
                        secondary: 'Someone is caught trying to sabotage the efforts of the community. How does the community respond?'
                    },
                    '9': {
                        primary: 'The community works constantly, and as a result a project finishes early.',
                        secondary: 'A group goes out to explore the map more thoroughly, and finds something that had been previously overlooked.'
                    },
                    '10': {
                        primary: 'Harvest is here and plentiful. Add an Abundance.',
                        secondary: 'Cold autumn winds drive out your enemies. Remove a threatening force from the map and the area.'
                    },
                    'J': {
                        primary: 'A project finishes early. Which one? Why?',
                        secondary: 'If there are no projects underway, restlessness creates animosity, which leads to violence. Who gets hurt?'
                    },
                    'Q': {
                        primary: 'Disease spreads through the community. Choose one: You spend the week quarantining and treating the disease. Project dice are not reduced this week.',
                        secondary: 'Nobody knows what to do about it. Add "Health and Fertility" as a Scarcity.'
                    },
                    'K': {
                        primary: 'A natural disaster strikes the area. Choose one: You focus on getting everyone to safety. Remove an Abundance and a project fails.',
                        secondary: 'You focus on protecting your supplies and hard work at any cost. Several people die as a result.'
                    }
                }
            }
        };        const UI_CONSTANTS = {
            SELECTORS: {
                HEARTS_BTN: 'heartsBtn',
                DIAMONDS_BTN: 'diamondsBtn',
                SPADES_BTN: 'spadesBtn',
                CLUBS_BTN: 'clubsBtn',
                DRAW_BTN: 'drawBtn',
                CARD_COUNT: 'cardCount',
                CARD_DISPLAY: 'cardDisplay',
                CARD_SYMBOL: 'cardSymbol',
                CARD_VALUE: 'cardValue',
                CARD_SUIT: 'cardSuit',
                CARD_PRIMARY: 'cardPrimary',
                CARD_SECONDARY: 'cardSecondary',
                CARD_HISTORY: 'cardHistory',
                // Overlay selectors
                CARD_OVERLAY: 'cardOverlay',
                OVERLAY_SYMBOL: 'overlaySymbol',
                OVERLAY_VALUE: 'overlayValue',
                OVERLAY_SUIT: 'overlaySuit',
                OVERLAY_PRIMARY: 'overlayPrimary',
                OVERLAY_SECONDARY: 'overlaySecondary',
                CLOSE_OVERLAY: 'closeOverlay',
                // Season theme selectors
                SEASON_BANNER: 'seasonBanner',
                SEASON_ICONS: 'seasonIcons',
                SEASON_NAME: 'seasonName',
                SEASON_DESCRIPTION: 'seasonDescription'
            },            CLASSES: {
                SUIT_BTN: 'suit-btn',
                ACTIVE: 'active',
                HIDDEN: 'hidden',
                DISABLED: 'opacity-50 cursor-not-allowed',
                RED_CARD: 'border-red-700 text-red-400 bg-gray-700',
                BLACK_CARD: 'border-gray-600 text-gray-200 bg-gray-600',
                RED_SYMBOL: 'text-red-500 text-6xl mb-4',
                BLACK_SYMBOL: 'text-gray-200 text-6xl mb-4'
            }
        };

        // ============== UTILITY FUNCTIONS ==============

        /**
         * Shuffles an array using the Fisher-Yates shuffle algorithm
         * @param {Array} array - The array to shuffle
         * @returns {Array} - A new shuffled array
         */
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        /**
         * Creates a deck of cards for a specific suit
         * @param {string} suit - The suit name
         * @param {Array} values - Array of card values
         * @param {Object} colors - Object mapping suits to colors
         * @param {Object} symbols - Object mapping suits to symbols
         * @param {Object} cardContent - Object containing card content by suit and value
         * @returns {Array} - Array of card objects
         */
        function createSuitDeck(suit, values, colors, symbols, cardContent) {
            const deck = [];
            values.forEach(value => {
                deck.push({
                    value,
                    suit,
                    color: colors[suit],
                    symbol: symbols[suit],
                    content: {
                        primary: cardContent?.[suit]?.[value]?.primary || 'No primary content',
                        secondary: cardContent?.[suit]?.[value]?.secondary || 'No secondary content'
                    }
                });
            });
            return shuffleArray(deck);
        }

        /**
         * Gets DOM element by ID with error handling
         * @param {string} id - Element ID
         * @returns {HTMLElement} - DOM element
         */
        function getElementById(id) {
            const element = document.getElementById(id);
            if (!element) {
                console.error(`Element with ID '${id}' not found`);
            }
            return element;
        }        /**
         * Creates a card element for the history display
         * @param {Object} card - Card object
         * @param {Object} uiClasses - UI class constants
         * @returns {HTMLElement} - Card DOM element
         */        function createCardHistoryElement(card, uiClasses) {
            const cardElement = document.createElement('div');
            const cardClass = card.color === 'red' ? uiClasses.RED_CARD : uiClasses.BLACK_CARD;
            cardElement.className = `p-2 border rounded ${cardClass} cursor-pointer hover:shadow-lg hover:bg-gray-500 transition-all`;
            cardElement.innerHTML = `
                <div class="text-sm font-semibold">${card.value}</div>
                <div class="text-xs">${card.symbol}</div>
            `;
            
            // Store card data for tooltip or click events
            cardElement.dataset.suit = card.suit;
            cardElement.dataset.value = card.value;
            cardElement.dataset.primary = card.content.primary;
            cardElement.dataset.secondary = card.content.secondary;
            cardElement.dataset.symbol = card.symbol;
            cardElement.dataset.color = card.color;
            
            // Add title attribute for quick reference on hover
            cardElement.title = `Click to view details`;
            
            // Add click event to show overlay
            cardElement.addEventListener('click', () => showCardOverlay(card));
            
            return cardElement;
        }
          /**
         * Shows the card overlay with details of the clicked card
         * @param {Object} card - The card to display in the overlay
         */
        function showCardOverlay(card) {
            const overlay = getElementById(UI_CONSTANTS.SELECTORS.CARD_OVERLAY);
            const overlaySymbol = getElementById(UI_CONSTANTS.SELECTORS.OVERLAY_SYMBOL);
            const overlayValue = getElementById(UI_CONSTANTS.SELECTORS.OVERLAY_VALUE);
            const overlaySuit = getElementById(UI_CONSTANTS.SELECTORS.OVERLAY_SUIT);
            const overlayPrimary = getElementById(UI_CONSTANTS.SELECTORS.OVERLAY_PRIMARY);
            const overlaySecondary = getElementById(UI_CONSTANTS.SELECTORS.OVERLAY_SECONDARY);
            
            if (!overlay || !overlaySymbol || !overlayValue || !overlaySuit || !overlayPrimary || !overlaySecondary) {
                console.error('Overlay elements not found');
                return;
            }
            
            // Set symbol styling based on card color
            overlaySymbol.textContent = card.symbol;
            overlaySymbol.className = card.color === 'red' 
                ? UI_CONSTANTS.CLASSES.RED_SYMBOL 
                : UI_CONSTANTS.CLASSES.BLACK_SYMBOL;
                
            // Fill in card details
            overlayValue.textContent = card.value;
            overlaySuit.textContent = card.suit;
            overlayPrimary.textContent = card.content.primary;
            overlaySecondary.textContent = card.content.secondary;
            
            // Show the overlay
            overlay.classList.remove(UI_CONSTANTS.CLASSES.HIDDEN);
            
            // Add event listener for ESC key to close overlay
            document.addEventListener('keydown', closeOverlayOnEsc);
        }
        
        /**
         * Close the overlay when ESC key is pressed
         * @param {KeyboardEvent} event - Keyboard event
         */
        function closeOverlayOnEsc(event) {
            if (event.key === 'Escape') {
                closeCardOverlay();
            }
        }
        
        /**
         * Closes the card overlay
         */
        function closeCardOverlay() {
            const overlay = getElementById(UI_CONSTANTS.SELECTORS.CARD_OVERLAY);
            if (overlay) {
                overlay.classList.add(UI_CONSTANTS.CLASSES.HIDDEN);
                // Remove ESC key event listener
                document.removeEventListener('keydown', closeOverlayOnEsc);
            }
        }

        // ============== MAIN CLASS ==============

        /**
         * Main class for managing The Quiet Year card deck
         */
        class QuietYearDeck {            constructor() {
                console.log('Initializing QuietYearDeck');
                this.activeSuit = GAME_CONSTANTS.DEFAULT_SUIT;
                this.decks = {};
                this.drawnCards = [];
                
                this.initializeDecks();
                this.initEventListeners();
                this.updateSeasonTheme(this.activeSuit);
                this.updateUI();
            }

            /**
             * Initialize all suit decks
             */            initializeDecks() {
                GAME_CONSTANTS.SUITS.forEach(suit => {
                    this.decks[suit] = createSuitDeck(
                        suit,
                        GAME_CONSTANTS.VALUES,
                        GAME_CONSTANTS.COLORS,
                        GAME_CONSTANTS.SYMBOLS,
                        GAME_CONSTANTS.CARD_CONTENT
                    );
                });
                console.log('All decks initialized');
            }

            /**
             * Set up event listeners for all buttons
             */
            initEventListeners() {
                console.log('Setting up event listeners');
                const buttonMappings = [
                    { id: UI_CONSTANTS.SELECTORS.HEARTS_BTN, suit: 'Hearts' },
                    { id: UI_CONSTANTS.SELECTORS.DIAMONDS_BTN, suit: 'Diamonds' },
                    { id: UI_CONSTANTS.SELECTORS.SPADES_BTN, suit: 'Spades' },
                    { id: UI_CONSTANTS.SELECTORS.CLUBS_BTN, suit: 'Clubs' }
                ];

                buttonMappings.forEach(({ id, suit }) => {
                    const button = getElementById(id);
                    if (button) {
                        button.addEventListener('click', () => this.setActiveSuit(suit));
                        console.log(`Added click listener to ${id}`);
                    }
                });

                const drawButton = getElementById(UI_CONSTANTS.SELECTORS.DRAW_BTN);
                if (drawButton) {
                    drawButton.addEventListener('click', () => this.drawCard());
                    console.log('Added click listener to draw button');
                }
                
                // Add event listener for closing the overlay                // Add event listener for closing the overlay
                const closeButton = getElementById(UI_CONSTANTS.SELECTORS.CLOSE_OVERLAY);
                if (closeButton) {
                    closeButton.addEventListener('click', closeCardOverlay);
                    console.log('Added click listener to close overlay button');
                }
                
                // Add click listener to close overlay when clicking outside the card
                const overlayElement = getElementById(UI_CONSTANTS.SELECTORS.CARD_OVERLAY);
                if (overlayElement) {
                    overlayElement.addEventListener('click', (event) => {
                        // Only close if clicking on the background (not the card content)
                        if (event.target === overlayElement) {
                            closeCardOverlay();
                        }
                    });
                }

                // Close overlay button
                const closeOverlayButton = getElementById('closeOverlay');
                if (closeOverlayButton) {
                    closeOverlayButton.addEventListener('click', () => this.closeOverlay());
                    console.log('Added click listener to close overlay button');
                }
            }            /**
             * Set the active suit and update UI
             * @param {string} suit - The suit to activate
             */
            setActiveSuit(suit) {
                console.log(`Setting active suit to: ${suit}`);
                if (!GAME_CONSTANTS.SUITS.includes(suit)) {
                    console.error(`Invalid suit: ${suit}`);
                    return;
                }

                this.activeSuit = suit;
                this.updateActiveButton();
                this.updateSeasonTheme(suit);
                this.updateUI();
            }
            
            /**
             * Update the season theme based on the selected suit
             * @param {string} suit - The active suit
             */
            updateSeasonTheme(suit) {
                const seasonData = GAME_CONSTANTS.SEASONS[suit];
                if (!seasonData) return;
                
                const banner = getElementById(UI_CONSTANTS.SELECTORS.SEASON_BANNER);
                const icons = getElementById(UI_CONSTANTS.SELECTORS.SEASON_ICONS);
                const name = getElementById(UI_CONSTANTS.SELECTORS.SEASON_NAME);
                const description = getElementById(UI_CONSTANTS.SELECTORS.SEASON_DESCRIPTION);
                
                if (!banner || !icons || !name || !description) {
                    console.error('Season theme elements not found');
                    return;
                }
                
                // Update text content
                icons.textContent = seasonData.icons;
                name.textContent = seasonData.name;
                description.textContent = seasonData.description;
                
                // Remove all gradient classes
                const allGradientFromClasses = ['from-green-900', 'from-yellow-800', 'from-blue-900', 'from-orange-900'];
                const allGradientToClasses = ['to-green-700', 'to-yellow-600', 'to-blue-800', 'to-orange-800'];
                const allBorderClasses = ['border-green-600', 'border-yellow-500', 'border-blue-700', 'border-orange-700'];
                const allTextClasses = ['text-green-200', 'text-yellow-200', 'text-blue-100', 'text-orange-100'];
                
                allGradientFromClasses.forEach(cls => banner.classList.remove(cls));
                allGradientToClasses.forEach(cls => banner.classList.remove(cls));
                allBorderClasses.forEach(cls => banner.classList.remove(cls));
                allTextClasses.forEach(cls => name.classList.remove(cls));
                
                // Add new classes
                banner.classList.add(seasonData.gradientFrom, seasonData.gradientTo, seasonData.borderColor);
                name.classList.add(seasonData.textColor);
                
                console.log(`Updated season theme to ${seasonData.name}`);
            }

            /**
             * Update the active button styling
             */
            updateActiveButton() {
                // Remove active class from all suit buttons
                document.querySelectorAll(`.${UI_CONSTANTS.CLASSES.SUIT_BTN}`)
                    .forEach(btn => btn.classList.remove(UI_CONSTANTS.CLASSES.ACTIVE));

                // Add active class to current suit button
                const activeButton = getElementById(this.activeSuit.toLowerCase() + 'Btn');
                if (activeButton) {
                    activeButton.classList.add(UI_CONSTANTS.CLASSES.ACTIVE);
                    console.log(`Set active class on ${this.activeSuit.toLowerCase()}Btn`);
                }
            }

            /**
             * Draw a card from the active suit deck
             */
            drawCard() {
                console.log(`Drawing card from ${this.activeSuit}`);
                const activeDeck = this.decks[this.activeSuit];
                
                if (activeDeck.length === 0) {
                    alert(`No more cards in ${this.activeSuit}!`);
                    return;
                }

                const card = activeDeck.pop();
                this.drawnCards.push(card);
                
                this.displayCard(card);
                this.updateHistory();
                this.updateUI();
            }

            /**
             * Display the drawn card
             * @param {Object} card - The card to display
             */
            displayCard(card) {
                const cardDisplay = getElementById(UI_CONSTANTS.SELECTORS.CARD_DISPLAY);
                const cardSymbol = getElementById(UI_CONSTANTS.SELECTORS.CARD_SYMBOL);
                const cardValue = getElementById(UI_CONSTANTS.SELECTORS.CARD_VALUE);
                const cardSuit = getElementById(UI_CONSTANTS.SELECTORS.CARD_SUIT);
                const cardPrimary = getElementById(UI_CONSTANTS.SELECTORS.CARD_PRIMARY);
                const cardSecondary = getElementById(UI_CONSTANTS.SELECTORS.CARD_SECONDARY);

                if (!cardDisplay || !cardSymbol || !cardValue || !cardSuit || !cardPrimary || !cardSecondary) {
                    console.error('Card display elements not found');
                    return;
                }

                // Display card identity (symbol, value, suit)
                cardSymbol.textContent = card.symbol;                cardSymbol.className = card.color === 'red' 
                    ? UI_CONSTANTS.CLASSES.RED_SYMBOL 
                    : UI_CONSTANTS.CLASSES.BLACK_SYMBOL;
                
                cardValue.textContent = card.value;
                cardSuit.textContent = card.suit;

                // Display card content
                cardPrimary.textContent = card.content.primary;
                cardSecondary.textContent = card.content.secondary;

                // Show the card
                cardDisplay.classList.remove(UI_CONSTANTS.CLASSES.HIDDEN);
                
                console.log(`Displayed card: ${card.value} of ${card.suit}`);
            }

            /**
             * Add the drawn card to the history display
             */
            updateHistory() {
                const history = getElementById(UI_CONSTANTS.SELECTORS.CARD_HISTORY);
                if (!history) {
                    console.error('Card history element not found');
                    return;
                }

                const lastCard = this.drawnCards[this.drawnCards.length - 1];
                const cardElement = createCardHistoryElement(lastCard, UI_CONSTANTS.CLASSES);
                
                history.appendChild(cardElement);
            }

            /**
             * Update the UI elements (card count, button state)
             */
            updateUI() {
                this.updateCardCount();
                this.updateDrawButton();
            }

            /**
             * Update the card count display
             */
            updateCardCount() {
                const cardCount = getElementById(UI_CONSTANTS.SELECTORS.CARD_COUNT);
                if (cardCount) {
                    cardCount.textContent = this.decks[this.activeSuit].length;
                }
            }

            /**
             * Update the draw button state
             */
            updateDrawButton() {
                const drawBtn = getElementById(UI_CONSTANTS.SELECTORS.DRAW_BTN);
                if (!drawBtn) return;

                const isEmpty = this.decks[this.activeSuit].length === 0;
                drawBtn.disabled = isEmpty;

                if (isEmpty) {
                    drawBtn.classList.add(...UI_CONSTANTS.CLASSES.DISABLED.split(' '));
                } else {
                    drawBtn.classList.remove(...UI_CONSTANTS.CLASSES.DISABLED.split(' '));
                }
            }

            /**
             * Close the card overlay
             */
            closeOverlay() {
                const overlay = getElementById('cardOverlay');
                if (overlay) {
                    overlay.classList.add('hidden');
                    console.log('Closed card overlay');
                }
            }
        }

        // Initialize the game when the DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM fully loaded');
            try {
                window.quietYearGame = new QuietYearDeck();
                console.log('Game initialized successfully');
            } catch (error) {
                console.error('Error initializing game:', error);
            }
        });

        // If the DOM is already loaded, initialize immediately
        if (document.readyState === 'interactive' || document.readyState === 'complete') {
            console.log('DOM already loaded, initializing immediately');
            try {
                window.quietYearGame = new QuietYearDeck();
                console.log('Game initialized successfully');
            } catch (error) {
                console.error('Error initializing game:', error);
            }
        }
    </script>    <style>
        .suit-btn.active {
            box-shadow: 0 0 0 3px #4B5563;
            transform: scale(1.05);
        }
        
        /* Custom Tailwind colors that don't exist by default */
        .bg-gray-750 {
            background-color: #2a3340;
        }
        .bg-gray-850 {
            background-color: #1a202c;
        }
    </style>
</body>
</html>
